---
title: "Hot Hand Assignment"
author: "Jeffrey Naecker"
date: "2/11/2019"
output: html_document
---

## Basic example

Let's imagine flipping a coin four times.  We can model this using the `sample` function, which will take a random sample from the set of values we give it.  We can specify that we want 4 trials (flips in this case), and the sampling should be with replacement.  

```{r}
sample(c("T", "H"), 4, replace = T)
```

You can run the code above several times to see that the sequence of flips is changing each time.  

Next, we want to know what faction of flips immediatly following heads were also heads.  We can achieve this with the following code. First let's save the sequence of flips as an object called `flips`:

```{r}
flips <- sample(c("T", "H"), 4, replace = T)
```

Next, we want to know which flips were heads.  For this, we can use the `which` function:

```{r}
which(flips == "H")
```

Then we want to look at the flips that *follow* these.  We can simply add one to the indices, and check whether those flips are heads.

```{r}
flips[which(flips == "H") + 1] == "H"
```

We may get an NA if the last flip was heads, which is fine.  Finally, we want to average these true and false values.  When we do this, we calculate the fraction of the logicals that are true.

```{r}
mean(flips[which(flips == "H") + 1] == "H", na.rm = T)
```

Recall our primary question: What number do we expect to get out of this process?  We might be tempted to say the expected value is 0.5; after all, the coin flips are independent, so the probability of flipping a heads after a heads is 0.5.  

Now, one run-through of this simiulation is not very conclusive, and its hard to tell from replicating a handful of times what the average output of this process is.  Lets repeat our simulation a bunch of times, and then calculate the average result.

```{r}
reps <- 1e4
probs <- rep(NA, reps)

for (i in c(1:reps)) {
  flips <- sample(c("T", "H"), 4, replace = T)
  probs[i] <- mean(flips[which(flips == "H") + 1] == "H", na.rm = T)
}

mean(probs, na.rm = T) # there will be some NAs because some sets of 4 flips will have no heads
```

The answer you get should be around 0.4, not 0.5 as we might expect.

## Exercises

### Exercise 1

Veryify the following claim^[https://statmodeling.stat.columbia.edu/2015/07/09/hey-guess-what-there-really-is-a-hot-hand/]:

> With sequences of length 10, the average streakiness statistic (that is, for each person you compute the conditional probability proportion that he gets heads, conditional on him having just got heads on the previous flip, and then you average this across people), is .445. This is pretty far from .5, given that previous estimates of streak-shooting probability have been in the range of 2 percentage points.

To answer, this, you should only need to slightly modify the code block immediately above.  You can assume that heads stand in for makes, and tails stand in for misses.

```{r exercise-1-answer}
for (i in c(1:reps)) {
  flips <- sample(c("T", "H"), 10, replace = T)
  probs[i] <- mean(flips[which(flips == "H") + 1] == "H", na.rm = T) 
}

mean(probs, na.rm = T)
```


### Exercise 2

Verify the following claim[^https://statmodeling.stat.columbia.edu/2016/02/18/miller-and-sanjurjo-share-5-tips-on-how-to-hit-the-zeitgeist-jackpot/]:

> Imagine Steph Curry shows up to the original hot hand study of Gilovich, Vallone, and Tversky (1985). Steph will shoot 100 shots. Suppose Steph Curry always has the same probability of success, for example, like a 50/50 fair coin. Notice we are assuming Steph Curry doesn’t get hot. Now calculate (1) Curry’s field goal percentage on shots taken when his previous 3 shots (or more) are makes and (2) Curry’s field goal percentage on shots taken when his previous 3 shots (or more) are misses. What do expect? If you are like most people, your intuition tells you that you should expect his field goal percentage to be the same in each case. This intuition is incorrect. In fact, you should expect Curry’s field goal percentage to be 46 percent after 3 (or more) makes, and 54 percent after 3 (or more) misses. Steph Curry is expected to shoot 8 percentage points better after 3 misses in a row than after three makes in row. 

Again, you can use our work above, and assume that heads stand in for makes and tails stand in for misses. You'll also notice that we now need to look for streaks of length three, not length one as we have been doing so far.  To do this, you can take advantage of the `streaks` function that I have provided below.  

```{r}
# function to calculate streaks
# takes in a sequence of coin flips of any length
# optional count argument says what counts as a successful trial
# returns a vector of the same length
# value of vector at any position is the streak count up to (but not including) that entry 
streaks <- function(flips, count = "H"){
  
  # make outout vector and populate first 2 entries
  output <- rep(NA, length(flips))
  output[1] <- 0 # no streaks possible on first trial
  output[2] <- ifelse(flips[1] == count, 1, 0)
  
  for (i in 3:length(flips)) {
      
    # if git a hit
    if (flips[i - 1] == count) {
      # add one to streak
      output[i] <- output[i - 1] + 1
    }
    else{
      # otherwise, reset streak
      output[i] <- 0
    }
    
  }
  return(output)
}

streaks(c("H", "H", "T", "T"))  # should give 0,1,2,0
streaks(c("H", "H", "T", "T"), count = "T")  # should give 0,0,0,1
```

Armed with this function, you should now be able to modify your answer to the previous exercise to generate the desired numbers in this exercise.  Note you need to calculate *two* quantities: the make percentage after a streak of three or more makes, and the make percentage after three or more misses.

```{r exercise-2-answer}
# field goal percentage after three or more makes in a row
for (i in c(1:reps)) {
  flips <- sample(c("T", "H"), 100, replace = T)
  probs[i] <- mean(flips[which(streaks(flips) >= 3)] == "H", na.rm = T) 
}

mean(probs, na.rm = T)

# field goal percentage after three or more misses in a row
for (i in c(1:reps)) {
  flips <- sample(c("T", "H"), 100, replace = T)
  probs[i] <- mean(flips[which(streaks(flips, count = "T") >= 3)] == "H", na.rm = T) 
}

mean(probs, na.rm = T)
```

### Exercise 3

Use a simulation to replicate Figure 1 from the Econometrica paper[^https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2627354].

```{r}
##will have to change lines to adjust for sequence lengths and probabilities
##takes in probability of getting head(p), streak length(k), and number of shots(n)
#expand.grid
#calculate % of shots they make after streak of that length
#function
#expand.grid(c(1:100), c("a","b"))

calculate_frequency <-function(k,n,p){
  reps<-1e4
  probs <- rep(NA, reps)
  if (p==.5){
    if (k==1){
      for (i in c(1:reps)) {
        steph <- sample(c("M", "H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=1)] == "H")
    }
  
      mean(probs, na.rm=T)
    }
    else if (k==2){
      for (i in c(1:reps)) {
    steph <- sample(c("M", "H"), n, replace = T)
    probs[i] <- mean(steph[which(streaks(steph, count="H")>=2)] == "H")
      }
      mean(probs, na.rm=T)
      }
    else if (k==3){
       for (i in c(1:reps)) {
        steph <- sample(c("M", "H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=3)] == "H") 
       }
      mean(probs, na.rm=T)
      }
    else {
      for (i in c(1:reps)) {
        steph <- sample(c("M", "H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=4)] == "H")
      }
     mean(probs, na.rm=T)}
  }
  else if (p==.75){
    if (k==1){
      for (i in c(1:reps)) {
        steph <- sample(c("M", "H","H","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=1)] == "H")
    }
  
      mean(probs, na.rm=T)
    }
    else if (k==2){
      for (i in c(1:reps)) {
    steph <- sample(c("M", "H","H","H"), n, replace = T)
    probs[i] <- mean(steph[which(streaks(steph, count="H")>=2)] == "H")
      }
      mean(probs, na.rm=T)
      }
    else if (k==3){
       for (i in c(1:reps)) {
        steph <- sample(c("M", "H","H","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=3)] == "H") 
       }
      mean(probs, na.rm=T)
      }
    else {
      for (i in c(1:reps)) {
        steph <- sample(c("M", "H","H","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=4)] == "H")
      }
     mean(probs, na.rm=T)}
  }
  else{
    if (k==1){
      for (i in c(1:reps)) {
        steph <- sample(c("M", "M","M","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=1)] == "H")
    }
  
      mean(probs, na.rm=T)
    }
    else if (k==2){
      for (i in c(1:reps)) {
    steph <- sample(c("M", "M","M","H"), n, replace = T)
    probs[i] <- mean(steph[which(streaks(steph, count="H")>=2)] == "H")
      }
      mean(probs, na.rm=T)
      }
    else if (k==3){
       for (i in c(1:reps)) {
        steph <- sample(c("M", "M","M","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=3)] == "H") 
       }
      mean(probs, na.rm=T)
      }
    else {
      for (i in c(1:reps)) {
        steph <- sample(c("M", "M","M","H"), n, replace = T)
        probs[i] <- mean(steph[which(streaks(steph, count="H")>=4)] == "H")
      }
     mean(probs, na.rm=T)}
  }
}

expand.grid(k = c(1, 2, 3, 4), n = c(5:100), p = c(0.25, 0.5, 0.75))
# add frequency column using calculate_frequency function

# make graph as in paper
ggplot() +
  geom_line(aes(x = n, y = frequency, color = k, group = p)) +
  facet_wrap(~p)
  
```

